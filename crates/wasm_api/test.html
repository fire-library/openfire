<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>OpenFire WASM Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .function-test {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .result {
            background-color: #f0f8ff;
            padding: 10px;
            margin-top: 10px;
            border-radius: 3px;
        }
        .error {
            background-color: #ffebee;
            color: #d32f2f;
        }
    </style>
</head>
<body>
    <h1>OpenFire WebAssembly JavaScript Bindings Test</h1>
    
    <div id="loading">Loading WASM module...</div>
    <div id="content" style="display: none;">
        
        <div class="function-test">
            <h3>Test 1: Hot Gas Temperature Increase (Equation 2.1)</h3>
            <p>Parameters: q=1000.0 kW, a_v=[2.5, 1.5] m², h_v=[2.0, 1.0] m, a_t=75.0 m², h_k=0.035 kW/m²K</p>
            <div id="test1-result" class="result"></div>
        </div>

        <div class="function-test">
            <h3>Test 2: Compartment Interior Surface Area (Equation 2.2)</h3>
            <p>Parameters: w_c=7.5 m, l_c=4.0 m, h_c=2.75 m, a_v=4.5 m²</p>
            <div id="test2-result" class="result"></div>
        </div>

        <div class="function-test">
            <h3>Test 3: Heat Transfer Coefficient - Long Times/Thin Walls (Equation 2.3)</h3>
            <p>Parameters: k=0.002 kW/mK, delta=0.25 m</p>
            <div id="test3-result" class="result"></div>
        </div>

        <div class="function-test">
            <h3>Test 4: Thermal Penetration Time (Equation 2.4)</h3>
            <p>Parameters: rho=2400.0 kg/m³, c_p=1.17 kJ/kgK, k=0.002 kW/mK, delta=0.25 m</p>
            <div id="test4-result" class="result"></div>
        </div>

        <div class="function-test">
            <h3>Test 5: Density of Hot Gas Layer (Equation 2.13)</h3>
            <p>Parameters: t_g=500.0 K</p>
            <div id="test5-result" class="result"></div>
        </div>

    </div>

    <script type="module">
        import init, {
            hot_gas_temperature_increase,
            compartment_interior_surface_area,
            heat_transfer_coefficient_longtimes_or_thinwalls,
            thermal_penetration_time,
            density_hot_gas_layer
        } from './pkg/wasm_api.js';
        
        async function run() {
            try {
                // Initialize the WASM module
                await init();
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
                
                // Test 1: Hot Gas Temperature Increase
                try {
                    const q = 1000.0;
                    const a_v = new Float64Array([2.5, 1.5]);
                    const h_v = new Float64Array([2.0, 1.0]);
                    const a_t = 75.0;
                    const h_k = 0.035;
                    
                    const result1 = hot_gas_temperature_increase(q, a_v, h_v, a_t, h_k);
                    document.getElementById('test1-result').innerHTML = 
                        `✅ <strong>Result:</strong> ${result1.toFixed(2)} K`;
                } catch (e) {
                    document.getElementById('test1-result').innerHTML = 
                        `❌ <strong>Error:</strong> ${e.message}`;
                    document.getElementById('test1-result').classList.add('error');
                }
                
                // Test 2: Compartment Interior Surface Area
                try {
                    const result2 = compartment_interior_surface_area(7.5, 4.0, 2.75, 4.5);
                    document.getElementById('test2-result').innerHTML = 
                        `✅ <strong>Result:</strong> ${result2.toFixed(2)} m²`;
                } catch (e) {
                    document.getElementById('test2-result').innerHTML = 
                        `❌ <strong>Error:</strong> ${e.message}`;
                    document.getElementById('test2-result').classList.add('error');
                }
                
                // Test 3: Heat Transfer Coefficient
                try {
                    const result3 = heat_transfer_coefficient_longtimes_or_thinwalls(0.002, 0.25);
                    document.getElementById('test3-result').innerHTML = 
                        `✅ <strong>Result:</strong> ${result3.toFixed(6)} kW/m²K`;
                } catch (e) {
                    document.getElementById('test3-result').innerHTML = 
                        `❌ <strong>Error:</strong> ${e.message}`;
                    document.getElementById('test3-result').classList.add('error');
                }
                
                // Test 4: Thermal Penetration Time
                try {
                    const result4 = thermal_penetration_time(2400.0, 1.17, 0.002, 0.25);
                    document.getElementById('test4-result').innerHTML = 
                        `✅ <strong>Result:</strong> ${result4.toFixed(0)} s (${(result4/3600).toFixed(2)} hours)`;
                } catch (e) {
                    document.getElementById('test4-result').innerHTML = 
                        `❌ <strong>Error:</strong> ${e.message}`;
                    document.getElementById('test4-result').classList.add('error');
                }
                
                // Test 5: Density of Hot Gas Layer
                try {
                    const result5 = density_hot_gas_layer(500.0);
                    document.getElementById('test5-result').innerHTML = 
                        `✅ <strong>Result:</strong> ${result5.toFixed(3)} kg/m³`;
                } catch (e) {
                    document.getElementById('test5-result').innerHTML = 
                        `❌ <strong>Error:</strong> ${e.message}`;
                    document.getElementById('test5-result').classList.add('error');
                }
                
            } catch (error) {
                document.getElementById('loading').innerHTML = 
                    `❌ Failed to load WASM module: ${error.message}`;
            }
        }
        
        run();
    </script>
</body>
</html>